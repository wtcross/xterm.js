{"version":3,"file":"WebLinksAddon.mjs","sources":["../../addons/addon-web-links/out-es6/WebLinkProvider.js","../../addons/addon-web-links/out-es6/WebLinksAddon.js"],"sourcesContent":["export class WebLinkProvider {\n    constructor(_terminal, _regex, _handler, _options = {}) {\n        this._terminal = _terminal;\n        this._regex = _regex;\n        this._handler = _handler;\n        this._options = _options;\n    }\n    provideLinks(y, callback) {\n        const links = LinkComputer.computeLink(y, this._regex, this._terminal, this._handler);\n        callback(this._addCallbacks(links));\n    }\n    _addCallbacks(links) {\n        return links.map(link => {\n            link.leave = this._options.leave;\n            link.hover = (event, uri) => {\n                if (this._options.hover) {\n                    const { range } = link;\n                    this._options.hover(event, uri, range);\n                }\n            };\n            return link;\n        });\n    }\n}\nexport class LinkComputer {\n    static computeLink(y, regex, terminal, activate) {\n        const rex = new RegExp(regex.source, (regex.flags || '') + 'g');\n        const [lines, startLineIndex] = LinkComputer._getWindowedLineStrings(y - 1, terminal);\n        const line = lines.join('');\n        let match;\n        const result = [];\n        while (match = rex.exec(line)) {\n            const text = match[0];\n            try {\n                const url = new URL(text);\n                const urlText = decodeURI(url.toString());\n                if (text !== urlText && text + '/' !== urlText) {\n                    continue;\n                }\n            }\n            catch (e) {\n                continue;\n            }\n            const [startY, startX] = LinkComputer._mapStrIdx(terminal, startLineIndex, 0, match.index);\n            const [endY, endX] = LinkComputer._mapStrIdx(terminal, startY, startX, text.length);\n            if (startY === -1 || startX === -1 || endY === -1 || endX === -1) {\n                continue;\n            }\n            const range = {\n                start: {\n                    x: startX + 1,\n                    y: startY + 1\n                },\n                end: {\n                    x: endX,\n                    y: endY + 1\n                }\n            };\n            result.push({ range, text, activate });\n        }\n        return result;\n    }\n    static _getWindowedLineStrings(lineIndex, terminal) {\n        let line;\n        let topIdx = lineIndex;\n        let bottomIdx = lineIndex;\n        let length = 0;\n        let content = '';\n        const lines = [];\n        if ((line = terminal.buffer.active.getLine(lineIndex))) {\n            const currentContent = line.translateToString(true);\n            if (line.isWrapped && currentContent[0] !== ' ') {\n                length = 0;\n                while ((line = terminal.buffer.active.getLine(--topIdx)) && length < 2048) {\n                    content = line.translateToString(true);\n                    length += content.length;\n                    lines.push(content);\n                    if (!line.isWrapped || content.indexOf(' ') !== -1) {\n                        break;\n                    }\n                }\n                lines.reverse();\n            }\n            lines.push(currentContent);\n            length = 0;\n            while ((line = terminal.buffer.active.getLine(++bottomIdx)) && line.isWrapped && length < 2048) {\n                content = line.translateToString(true);\n                length += content.length;\n                lines.push(content);\n                if (content.indexOf(' ') !== -1) {\n                    break;\n                }\n            }\n        }\n        return [lines, topIdx];\n    }\n    static _mapStrIdx(terminal, lineIndex, rowIndex, stringIndex) {\n        const buf = terminal.buffer.active;\n        const cell = buf.getNullCell();\n        let start = rowIndex;\n        while (stringIndex) {\n            const line = buf.getLine(lineIndex);\n            if (!line) {\n                return [-1, -1];\n            }\n            for (let i = start; i < line.length; ++i) {\n                line.getCell(i, cell);\n                const chars = cell.getChars();\n                const width = cell.getWidth();\n                if (width) {\n                    stringIndex -= chars.length || 1;\n                    if (i === line.length - 1 && chars === '') {\n                        const line = buf.getLine(lineIndex + 1);\n                        if (line && line.isWrapped) {\n                            line.getCell(0, cell);\n                            if (cell.getWidth() === 2) {\n                                stringIndex += 1;\n                            }\n                        }\n                    }\n                }\n                if (stringIndex < 0) {\n                    return [lineIndex, i];\n                }\n            }\n            lineIndex++;\n            start = 0;\n        }\n        return [lineIndex, start];\n    }\n}\n//# sourceMappingURL=WebLinkProvider.js.map","import { WebLinkProvider } from './WebLinkProvider';\nconst strictUrlRegex = /https?:[/]{2}[^\\s\"'!*(){}|\\\\\\^<>`]*[^\\s\"':,.!?{}|\\\\\\^~\\[\\]`()<>]/;\nfunction handleLink(event, uri) {\n    const newWindow = window.open();\n    if (newWindow) {\n        try {\n            newWindow.opener = null;\n        }\n        catch {\n        }\n        newWindow.location.href = uri;\n    }\n    else {\n        console.warn('Opening link blocked as opener could not be cleared');\n    }\n}\nexport class WebLinksAddon {\n    constructor(_handler = handleLink, _options = {}) {\n        this._handler = _handler;\n        this._options = _options;\n    }\n    activate(terminal) {\n        this._terminal = terminal;\n        const options = this._options;\n        const regex = options.urlRegex || strictUrlRegex;\n        this._linkProvider = this._terminal.registerLinkProvider(new WebLinkProvider(this._terminal, regex, this._handler, options));\n    }\n    dispose() {\n        this._linkProvider?.dispose();\n    }\n}\n//# sourceMappingURL=WebLinksAddon.js.map"],"names":[],"mappings":"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"}