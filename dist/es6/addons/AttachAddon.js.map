{"version":3,"file":"AttachAddon.js","sources":["../../../addons/addon-attach/out-es6/AttachAddon.js"],"sourcesContent":["export class AttachAddon {\n    constructor(socket, options) {\n        this._disposables = [];\n        this._socket = socket;\n        this._socket.binaryType = 'arraybuffer';\n        this._bidirectional = !(options && options.bidirectional === false);\n    }\n    activate(terminal) {\n        this._disposables.push(addSocketListener(this._socket, 'message', ev => {\n            const data = ev.data;\n            terminal.write(typeof data === 'string' ? data : new Uint8Array(data));\n        }));\n        if (this._bidirectional) {\n            this._disposables.push(terminal.onData(data => this._sendData(data)));\n            this._disposables.push(terminal.onBinary(data => this._sendBinary(data)));\n        }\n        this._disposables.push(addSocketListener(this._socket, 'close', () => this.dispose()));\n        this._disposables.push(addSocketListener(this._socket, 'error', () => this.dispose()));\n    }\n    dispose() {\n        for (const d of this._disposables) {\n            d.dispose();\n        }\n    }\n    _sendData(data) {\n        if (!this._checkOpenSocket()) {\n            return;\n        }\n        this._socket.send(data);\n    }\n    _sendBinary(data) {\n        if (!this._checkOpenSocket()) {\n            return;\n        }\n        const buffer = new Uint8Array(data.length);\n        for (let i = 0; i < data.length; ++i) {\n            buffer[i] = data.charCodeAt(i) & 255;\n        }\n        this._socket.send(buffer);\n    }\n    _checkOpenSocket() {\n        switch (this._socket.readyState) {\n            case WebSocket.OPEN:\n                return true;\n            case WebSocket.CONNECTING:\n                throw new Error('Attach addon was loaded before socket was open');\n            case WebSocket.CLOSING:\n                console.warn('Attach addon socket is closing');\n                return false;\n            case WebSocket.CLOSED:\n                throw new Error('Attach addon socket is closed');\n            default:\n                throw new Error('Unexpected socket state');\n        }\n    }\n}\nfunction addSocketListener(socket, type, handler) {\n    socket.addEventListener(type, handler);\n    return {\n        dispose: () => {\n            if (!handler) {\n                return;\n            }\n            socket.removeEventListener(type, handler);\n        }\n    };\n}\n//# sourceMappingURL=AttachAddon.js.map"],"names":[],"mappings":"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"}